<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ritual de Media Noche</title>
<style>
body{
    margin:0;
    background:black;
    color:white;
    font-family:Arial, sans-serif;
    overflow:hidden;
}

#startScreen{
    position:absolute;
    width:100%;
    height:100%;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background:radial-gradient(circle, #200000, black);
    animation: pulse 3s infinite;
}

@keyframes pulse{
    0%{background-color:#100000;}
    50%{background-color:#300000;}
    100%{background-color:#100000;}
}

h1{
    font-size:60px;
    text-align:center;
    letter-spacing:5px;
}

button{
    padding:15px 40px;
    font-size:20px;
    background:#700000;
    color:white;
    border:none;
    cursor:pointer;
}

canvas{
    display:none;
    background:black;
}

#hud{
    position:absolute;
    top:10px;
    left:10px;
    font-size:18px;
    display:none;
}

#energyBar{
    width:200px;
    height:20px;
    background:#333;
    margin-top:5px;
}

#energy{
    height:100%;
    width:100%;
    background:red;
}

#finalScreen{
    position:absolute;
    width:100%;
    height:100%;
    background:black;
    color:white;
    display:none;
    justify-content:center;
    align-items:center;
    font-size:30px;
    text-align:center;
}
</style>
</head>
<body>

<div id="startScreen">
    <h1>RITUAL DE MEDIA NOCHE</h1>
    <button onclick="startIntro()">ü©∏ INICIAR RITUAL</button>
</div>

<div id="hud">
    Puntaje: <span id="score">0</span><br>
    Combo: <span id="combo">0</span>
    <div id="energyBar">
        <div id="energy"></div>
    </div>
</div>

<canvas id="game" width="400" height="600"></canvas>

<div id="finalScreen">
    ‚ÄúEste ritual es solo para ti ‚ù§Ô∏è‚Äù
</div>

<audio id="intro" src="intro.mp3"></audio>
<audio id="music"></audio>

<script>
let canvas = document.getElementById("game");
let ctx = canvas.getContext("2d");
let notes = [];
let keys = ["a","s","d","f"];
let score = 0;
let combo = 0;
let energy = 100;
let level = 1;
let speed = 2;
let playing = false;

function startIntro(){
    document.getElementById("startScreen").style.display="none";
    document.getElementById("intro").play();
    setTimeout(startLevel, 3000);
}

function startLevel(){
    document.getElementById("hud").style.display="block";
    canvas.style.display="block";
    document.getElementById("music").src="nivel"+level+".mp3";
    document.getElementById("music").play();
    playing=true;
    if(level==1) speed=2;
    if(level==2) speed=3;
    if(level==3) speed=4;
    gameLoop();
}

function createNote(){
    let lane = Math.floor(Math.random()*4);
    notes.push({x:lane*100+40,y:0,lane:lane});
}

function drawNotes(){
    ctx.clearRect(0,0,400,600);
    for(let i=0;i<notes.length;i++){
        ctx.fillStyle="red";
        ctx.fillRect(notes[i].x,notes[i].y,20,20);
        notes[i].y+=speed;
        if(notes[i].y>600){
            notes.splice(i,1);
            energy-=10;
            combo=0;
        }
    }
}

function gameLoop(){
    if(!playing) return;
    if(Math.random()<0.03) createNote();
    drawNotes();
    document.getElementById("score").innerText=score;
    document.getElementById("combo").innerText=combo;
    document.getElementById("energy").style.width=energy+"%";

    if(energy<=0){
        alert("Fin del ritual");
        location.reload();
    }

    requestAnimationFrame(gameLoop);
}

document.addEventListener("keydown",function(e){
    let index = keys.indexOf(e.key);
    if(index>-1){
        for(let i=0;i<notes.length;i++){
            if(notes[i].lane==index && notes[i].y>500){
                notes.splice(i,1);
                score+=10;
                combo++;
                energy+=2;
                break;
            }
        }
    }
});

document.getElementById("music").addEventListener("ended",function(){
    level++;
    if(level<=3){
        startLevel();
    }else{
        playing=false;
        canvas.style.display="none";
        document.getElementById("hud").style.display="none";
        document.getElementById("finalScreen").style.display="flex";
    }
});
</script>

</body>
</html>

