<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ritual de Media Noche</title>

<style>
body{
    margin:0;
    background:black;
    color:white;
    font-family:Arial, sans-serif;
    overflow:hidden;
}

#startScreen{
    position:absolute;
    width:100%;
    height:100%;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background:radial-gradient(circle, #200000, black);
}

button{
    padding:15px 40px;
    font-size:20px;
    background:#700000;
    color:white;
    border:none;
    cursor:pointer;
}

canvas{
    display:none;
    background:black;
}

#hud{
    position:absolute;
    top:10px;
    left:10px;
    display:none;
}
</style>
</head>
<body>

<div id="startScreen">
    <h1>RITUAL DE MEDIA NOCHE</h1>
    <button onclick="startGame()">INICIAR</button>
</div>

<div id="hud">
    Puntaje: <span id="score">0</span>
</div>

<canvas id="game" width="400" height="600"></canvas>

<audio id="intro" src="intro.mp3"></audio>
<audio id="music"></audio>

<script>
let canvas = document.getElementById("game");
let ctx = canvas.getContext("2d");

let score = 0;
let level = 1;

let animationId = null;
let playing = false;

let player = { x:180, y:500, width:40, height:40 };
let notes = [];
let spawnTimer = 0;

// üî• INICIAR JUEGO
function startGame(){

    let intro = document.getElementById("intro");
    intro.currentTime = 0;
    intro.play();

    setTimeout(()=>{
        intro.pause();
        intro.currentTime = 0;
        startLevel();
    },2000);
}

// üî• INICIAR NIVEL
function startLevel(){

    document.getElementById("startScreen").style.display="none";
    document.getElementById("hud").style.display="block";
    canvas.style.display="block";

    let music = document.getElementById("music");
    music.src = "nivel" + level + ".mp3";
    music.currentTime = 0;
    music.play();

    playing = true;

    if(animationId) cancelAnimationFrame(animationId);
    gameLoop();
}

// üî• LOOP OPTIMIZADO
function gameLoop(){

    if(!playing) return;

    ctx.clearRect(0,0,400,600);

    // jugador
    ctx.fillStyle="red";
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // generar notas cada cierto tiempo
    spawnTimer++;
    if(spawnTimer > 40){
        notes.push({
            x: Math.random()*360,
            y: -20,
            width:20,
            height:20
        });
        spawnTimer = 0;
    }

    // mover notas
    for(let i = notes.length-1; i>=0; i--){
        let n = notes[i];
        n.y += 4;

        ctx.fillStyle="white";
        ctx.fillRect(n.x, n.y, n.width, n.height);

        // eliminar si sale pantalla
        if(n.y > 600){
            notes.splice(i,1);
        }

        // colisi√≥n simple
        if(n.x < player.x + player.width &&
           n.x + n.width > player.x &&
           n.y < player.y + player.height &&
           n.y + n.height > player.y){

            score++;
            document.getElementById("score").innerText = score;
            notes.splice(i,1);
        }
    }

    animationId = requestAnimationFrame(gameLoop);
}

// mover jugador
document.addEventListener("keydown", function(e){
    if(e.key === "ArrowLeft") player.x -= 20;
    if(e.key === "ArrowRight") player.x += 20;

    if(player.x < 0) player.x = 0;
    if(player.x > 360) player.x = 360;
});
</script>

</body>
</html>
